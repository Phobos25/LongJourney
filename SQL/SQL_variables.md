# Нумерация строк

Номер строки в таблице или запросе в некоторых версиях SQL можно получить с помощью оконной функции  row_number().  Когда создавался этот шаг версии SQL на платформе Stepik эта функция не поддерживалась. Сейчас версию изменили, оконные функции рассматриваются в следующем уроке.

На этом шаге нумерацию реализуем с помощью переменных.  Переменные задаются с помощью ключевого слова SET,  перед именем указывается символ @. Например, создадим переменную @row_num и присвоим ей значение 1:

```SQL
SET @row_num := 1;
```

Теперь эту переменную можно использовать в запросах,  кроме того в запросах можно изменить ее значение. 

Пример

Пронумеруем записи в таблице applicant_order.

Запрос:
```SQL
SET @row_num := 0;

SELECT *, (@row_num := @row_num + 1) AS str_num
FROM  applicant_order;
```

Результат:
```
+------------+-------------+------+---------+
| program_id | enrollee_id | itog | str_num |
+------------+-------------+------+---------+
| 1          | 3           | 235  | 1       |
| 1          | 2           | 226  | 2       |
| 1          | 1           | 219  | 3       |
| 2          | 6           | 276  | 4       |
| 2          | 3           | 235  | 5       |
| 2          | 2           | 226  | 6       |
| 3          | 6           | 270  | 7       |
| 3          | 4           | 239  | 8       |
| 3          | 5           | 200  | 9       |
| 4          | 6           | 270  | 10      |
| 4          | 3           | 247  | 11      |
| 4          | 5           | 200  | 12      |
+------------+-------------+------+---------+
```

## Задание

Занести в столбец ```str_id``` таблицы ```applicant_order``` нумерацию абитуриентов, которая начинается с 1 для каждой образовательной программы.

```SQL
SET @num_pr := 1;
SET @row_num := 0;

UPDATE applicant_order
   SET str_id = IF (@num_pr = program_id, @row_num := @row_num + 1, @row_num := 1 AND  @num_pr := program_id);

SELECT * FROM applicant_order
```

### Результат
```
Query result:
+--------+------------+-------------+------+
| str_id | program_id | enrollee_id | itog |
+--------+------------+-------------+------+
| 1      | 1          | 3           | 235  |
| 2      | 1          | 2           | 226  |
| 3      | 1          | 1           | 219  |
| 1      | 2          | 6           | 276  |
| 2      | 2          | 3           | 235  |
| 3      | 2          | 2           | 226  |
| 1      | 3          | 6           | 270  |
| 2      | 3          | 4           | 239  |
| 3      | 3          | 5           | 200  |
| 1      | 4          | 6           | 270  |
| 2      | 4          | 3           | 247  |
| 3      | 4          | 5           | 200  |
+--------+------------+-------------+------+
```

## Задание

Создать таблицу student,  в которую включить абитуриентов, которые могут быть рекомендованы к зачислению  в соответствии с планом набора. Информацию отсортировать сначала в алфавитном порядке по названию программ, а потом по убыванию итогового балла.

```SQL
CREATE TABLE student AS
SELECT name_program, name_enrollee, itog
  FROM 
      enrollee 
      INNER JOIN applicant_order ON enrollee.enrollee_id = applicant_order.enrollee_id
      INNER JOIN program         ON program.program_id = applicant_order.program_id
WHERE str_id <= plan
ORDER BY name_program, itog DESC;

SELECT * FROM student;
```

```
Affected rows: 8

Query result:
+-------------------------------------+-----------------+------+
| name_program                        | name_enrollee   | itog |
+-------------------------------------+-----------------+------+
| Математика и компьютерные науки     | Степанова Дарья | 276  |
| Мехатроника и робототехника         | Степанова Дарья | 270  |
| Мехатроника и робототехника         | Семенов Иван    | 247  |
| Мехатроника и робототехника         | Попов Илья      | 200  |
| Прикладная математика и информатика | Семенов Иван    | 235  |
| Прикладная математика и информатика | Абрамова Катя   | 226  |
| Прикладная механика                 | Степанова Дарья | 270  |
| Прикладная механика                 | Яковлева Галина | 239  |
+-------------------------------------+-----------------+------+
```