**Структура и наполнение таблицы ```book```**
```
+---------+-----------------------+------------------+--------+--------+
| book_id | title                 | author           | price  | amount |
+---------+-----------------------+------------------+--------+--------+
| 1       | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      |
| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 5      |
| 3       | Идиот                 | Достоевский Ф.М. | 460.00 | 10     |
| 4       | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 2      |
| 5       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     |
+---------+-----------------------+------------------+--------+--------+
```
# Задача 1

Магазин счёл, что классика уже не пользуется популярностью, поэтому необходимо в выборке:

1. Сменить всех авторов на "Донцова Дарья".

2. К названию каждой книги в начале дописать "Евлампия Романова и".

3. Цену поднять на 42%.

4. Отсортировать по убыванию цены и убыванию названия.

## Решение
```SQL
SELECT IF (author = "Донцова Дария", author, "Донцова Дария") AS author,
       IF (title, "Евлампия Романова и "+ title, CONCAT("Евлампия Романова и ", title)) AS title,
       ROUND(price * 1.42,2) AS price      
  FROM book
 ORDER BY price DESC, title DESC;
```

```
Query result:
+---------------+-------------------------------------------+---------+
| author        | title                                     | price   |
+---------------+-------------------------------------------+---------+
| Донцова Дарья | Евлампия романова и Братья Карамазовы     | 1134.59 |
| Донцова Дарья | Евлампия романова и Мастер и Маргарита    | 952.81  |
| Донцова Дарья | Евлампия романова и Стихотворения и поэмы | 923.00  |
| Донцова Дарья | Евлампия романова и Белая гвардия         | 767.51  |
| Донцова Дарья | Евлампия романова и Идиот                 | 653.20  |
+---------------+-------------------------------------------+---------+
```

# Задача 2
Определить стоимость доставки:
- для книг стоимостью 500 и менее, установить в размере 99,99
- при количестве книг на складе менее 5, установить в размере 149.99
- для остальных случаев доставка должна быть бесплатной
Определить новую стоимость для книг:
- для книг, совокупной стоимостью более 5000, добавить 20% к стоимости за экземпляр
- для остальных случаев снизить стоимость одного экземпляра на 20%
Настроить фильтр при выборке:
- только позиции творчества авторов: Булгаков и Есенин, при количестве экземпляров на складе: от 3 до 14 включительно.
Сортировку выполнить:
- по имени автора в порядке возрастания
- затем по названию в порядке убывания
- по стоимости доставки (от меньшей к большей)
В таблице должны быть отображены данные:
- автора
- название
- цену, как real_price
- количество
- новую цену, как new_price
- стоимость доставки, как delivery_price


## Решение
```SQL
SELECT title, author, price AS real_price,     
    IF (price * amount > 5000, ROUND(price * 1.2,2), ROUND(price * 0.8,2)) AS new_price,    
    IF (price <= 500, 99.99, IF (amount < 5, 149.99, 0)) AS delivery_price      
  FROM book
 WHERE author IN ('Булгаков М.А.','Есенин С.А.')
             AND amount BETWEEN 3 AND 14;
```

```
+--------------------+---------------+------------+-----------+----------------+
| title              | author        | real_price | new_price | delivery_price |
+--------------------+---------------+------------+-----------+----------------+
| Мастер и Маргарита | Булгаков М.А. | 670.99     | 536.79    | 149.99         |
| Белая гвардия      | Булгаков М.А. | 540.50     | 432.40    | 0              |
+--------------------+---------------+------------+-----------+----------------+
```

# Задача 3

Осталось **5 дней до конца месяца** и молодому магазину необходимо **подвести итоги**.

В конце прошлого месяца в пустой склад было закуплено **по 30** экземпляров книг каждого произведения.

1. Отдельным полем показать **количество экземпляров**, проданных за текущий месяц, по каждому произведению.
Назвать поле: **Продано**

2. Отдельным полем **выставить скидки** на книги, чтобы постараться продать до конца месяца плохо продаваемые:
    2.1. Если было продано **более 70%** книг (включительно), то скидку НЕ делаем.
    2.2. Если было продано **от 55% до 69%** книг (включительно), то скидку делаем **25%**.
    2.3. Если было продано **менее 54%** книг (включительно), то скидку делаем **55%**.
Назвать поле: **Новая_цена**

3. Отдельным полем показать, сколько необходимо закупить книг на основе процента продаж:
    3.1. Если было продано более **90%** книг (включительно), то закупить **на 25% больше** книг, чем в прошлом месяце.
    3.2. Если было продано **от 55% до 89%** книг (включительно), то закупить столько книг, чтобы стало **снова 30 шт**.
    3.3. Если было продано менее **54%** книг (включительно), то закупать **НЕ надо**.
Назвать поле: **Закупить**

4. Отсортировать по полю **Новая_цена** по убыванию.

5. Распечатать отчёт и отнести начальнику.


## Решение
```SQL
SELECT title       AS Название,
       author      AS Автор,
       price       AS Цена,
       amount      AS Осталось,
       (30-amount) AS Продано,
       ROUND(IF ((30-amount)/30 >= 0.7, price,
           IF((30-amount)/30 >= 0.55 AND (30-amount)/30 <= 0.69, price*0.75,
           IF((30-amount)/30< 55, price*0.45, price))), 2) AS Новая_цена,
       ROUND(IF ((30-amount)/30 >= 0.9, 30*1.25,
           IF((30-amount)/30<0.9 AND (30-amount)/30>=0.55, 30-amount,
           IF((30-amount)/30<0.55, 0, 0))),0)  AS Закупить
  FROM book
 ORDER BY Новая_цена DESC;
```
*Результат:*
```
+-----------------------+------------------+--------+----------+---------+------------+----------+
| Название              | Автор            | Цена   | Осталось | Продано | Новая_цена | Закупить |
+-----------------------+------------------+--------+----------+---------+------------+----------+
| Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 2        | 28      | 799.01     | 38       |
| Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3        | 27      | 670.99     | 38       |
| Белая гвардия         | Булгаков М.А.    | 540.50 | 5        | 25      | 540.50     | 25       |
| Идиот                 | Достоевский Ф.М. | 460.00 | 10       | 20      | 345.00     | 20       |
| Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15       | 15      | 292.50     | 0        |
+-----------------------+------------------+--------+----------+---------+------------+----------+
```
